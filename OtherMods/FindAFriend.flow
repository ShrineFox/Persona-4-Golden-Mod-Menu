//
// Imports
//

import("FindAFriend.msg");

//
// Script-level variable definitions
//

int pageOneMask;
int pageTwoMask;
int numSelectionsRemoved;
int isHoliday;
bool foxReady;

//
// Procedure declarations
//

void generate_hangout_menu()
{
    // Variables that store the location of the messages and whatnot
    int localVariable54 = HANG_OUT_MSG;
    int localVariable55 = HANG_OUT_SEL;

    // Get the day from 0-6, Sunday-Saturday
    int dayOfWeek;
    dayOfWeek = GET_DAY_OF_WEEK();
    // Get the time of day from 0-5, early morning to evening
    int timeOfDay;
    timeOfDay = GET_TIME_OF_DAY();

    // Variable to keep track of the page we're on
    int localVariable120 = 0;

    // Set all of the message variables based on whether the link is ready to level up
    SET_MSG_VAR(0, 621 + CHECK_IF_SL_LVLUP(31), 6);
    SET_MSG_VAR(1, 621 + (CHECK_IF_SL_LVLUP(21) || CHECK_IF_SL_LVLUP(22)), 6);
    // Chie
    SET_MSG_VAR(2, 621 + (CHECK_IF_SL_LVLUP(11) || CHECK_IF_SL_LVLUP(12)), 6);

    // If you try to check if Ayane will level up when Yumi is the S.link for the save the game crashes
    if (GET_SL_LEVEL(27) > 0 || GET_SL_LEVEL(28) > 0 || (GET_SL_LEVEL(25) == 0 && GET_SL_LEVEL(26) == 0 && GET_SL_LEVEL(27) == 0 && GET_SL_LEVEL(28) == 0))
    {
        SET_MSG_VAR(3, 621 + (CHECK_IF_SL_LVLUP(27) || CHECK_IF_SL_LVLUP(28)), 6);
    }

    SET_MSG_VAR(4, 621 + CHECK_IF_SL_LVLUP(29), 6);
    // Dojima reuses Eri's message vars as they're never available at night and the var limit is 32 :(
    if (GET_TIME_OF_DAY() == 5)
    {
        SET_MSG_VAR(4, 621 + CHECK_IF_SL_LVLUP(8), 6);
    }
    SET_MSG_VAR(5, 621 + CHECK_IF_SL_LVLUP(19), 6);
    // Nanako reuses Hisano's message vars as she's never available at night and the var limit is 32 :(
    if (GET_TIME_OF_DAY() == 5)
    {
        SET_MSG_VAR(5, 621 + CHECK_IF_SL_LVLUP(2), 6);
    }

    // Kanji
    SET_MSG_VAR(6, 621 + CHECK_IF_SL_LVLUP(10), 6);
 
    SET_MSG_VAR(7, 621 + (CHECK_IF_SL_LVLUP(33) || CHECK_IF_SL_LVLUP(34)), 6);
    SET_MSG_VAR(8, 621 + CHECK_IF_SL_LVLUP(18), 6);

    // Naoto
    SET_MSG_VAR(9, 621 + (CHECK_IF_SL_LVLUP(14) || CHECK_IF_SL_LVLUP(15)), 6);

    // Rise
    SET_MSG_VAR(10, 621 + (CHECK_IF_SL_LVLUP(3) || CHECK_IF_SL_LVLUP(4)), 6);

    SET_MSG_VAR(11, 621 + CHECK_IF_SL_LVLUP(9), 6);
    // Shrine fox hijacks Sayoko's variables as he's not available at night
    if (timeOfDay != 5)
    {
        // Can't use check if sl lvl up on fox (it's always ready) so instead use custom function that checks
        // if the quest needed has been completed
        check_if_fox_ready();
        SET_MSG_VAR(11, 621 + foxReady, 6);
    }

    SET_MSG_VAR(12, 621 + CHECK_IF_SL_LVLUP(23), 6);
    // Teddie uses Shu's message variable as he only is available at night
    if(timeOfDay != 5)
    {
        SET_MSG_VAR(12, 623, 6);
    }

    // Kou is 16, Daisuke 17
    if (GET_SL_LEVEL(16) > 0)
    {
        SET_MSG_VAR(13, 621 + CHECK_IF_SL_LVLUP(16), 6);
    }
    else
    {
        SET_MSG_VAR(13, 621 + CHECK_IF_SL_LVLUP(17), 6);
    }

    // Yosuke
    SET_MSG_VAR(14, 621 + CHECK_IF_SL_LVLUP(7), 6);

    // Yukiko
    SET_MSG_VAR(15, 621 + (CHECK_IF_SL_LVLUP(5) || CHECK_IF_SL_LVLUP(6)), 6);

    // If you try to check if Yumi will level up when Ayane is the S.link for the save the game crashes
    if (GET_SL_LEVEL(25) > 0 || GET_SL_LEVEL(26) > 0 || (GET_SL_LEVEL(25) == 0 && GET_SL_LEVEL(26) == 0 && GET_SL_LEVEL(27) == 0 && GET_SL_LEVEL(28) == 0))
    {
        SET_MSG_VAR(3, 621 + (CHECK_IF_SL_LVLUP(25) || CHECK_IF_SL_LVLUP(26)), 6);
    }

    // Set message variables for the level of each s link
    SET_MSG_VAR(16, GET_SL_LEVEL(31), 0);
    // Use whichever level is bigger for those that have two possible
    if (GET_SL_LEVEL(21) >= GET_SL_LEVEL(22))
    {
        SET_MSG_VAR(17, GET_SL_LEVEL(21), 0);
    }
    else
    {
        SET_MSG_VAR(17, GET_SL_LEVEL(22), 0);
    }

    if (GET_SL_LEVEL(11) >= GET_SL_LEVEL(12))
    {
        SET_MSG_VAR(18, GET_SL_LEVEL(11), 0);
    }
    else
    {
        SET_MSG_VAR(18, GET_SL_LEVEL(12), 0);
    }

    if (GET_SL_LEVEL(27) > 0 || GET_SL_LEVEL(28) > 0 || (GET_SL_LEVEL(25) == 0 && GET_SL_LEVEL(26) == 0 && GET_SL_LEVEL(27) == 0 && GET_SL_LEVEL(28) == 0))
    {
        if (GET_SL_LEVEL(27) >= GET_SL_LEVEL(28))
        {
            SET_MSG_VAR(19, GET_SL_LEVEL(27), 0);
        }
        else
        {
            SET_MSG_VAR(19, GET_SL_LEVEL(28), 0);
        }
    }

    SET_MSG_VAR(20, GET_SL_LEVEL(29), 0);
    // Dojima reuses Eri's message vars as they're never available at night and the var limit is 32 :(
    if (GET_TIME_OF_DAY() == 5)
    {
        SET_MSG_VAR(20, GET_SL_LEVEL(8), 0);
    }
    SET_MSG_VAR(21, GET_SL_LEVEL(19), 0);

    // Nanako reuses Hisano's message vars as she's never available at night and the var limit is 32 :(
    if (GET_TIME_OF_DAY() == 5)
    {
        SET_MSG_VAR(21, GET_SL_LEVEL(2), 0);
    }

    SET_MSG_VAR(22, GET_SL_LEVEL(10), 0);

    if (GET_SL_LEVEL(33) >= GET_SL_LEVEL(34))
    {
        SET_MSG_VAR(23, GET_SL_LEVEL(33), 0);
    }
    else
    {
        SET_MSG_VAR(23, GET_SL_LEVEL(34), 0);
    }
    SET_MSG_VAR(24, GET_SL_LEVEL(18), 0);

    if (GET_SL_LEVEL(14) >= GET_SL_LEVEL(15))
    {
        SET_MSG_VAR(25, GET_SL_LEVEL(14), 0);
    }
    else
    {
        SET_MSG_VAR(25, GET_SL_LEVEL(15), 0);
    }

    if (GET_SL_LEVEL(3) >= GET_SL_LEVEL(4))
    {
        SET_MSG_VAR(26, GET_SL_LEVEL(3), 0);
    }
    else
    {
        SET_MSG_VAR(26, GET_SL_LEVEL(4), 0);
    }
    SET_MSG_VAR(27, GET_SL_LEVEL(9), 0);
    // Shrine fox hijacks Sayoko's variables as he isn't available at night
    if (timeOfDay != 5)
    {
        SET_MSG_VAR(27, GET_SL_LEVEL(13), 0);
    }

    SET_MSG_VAR(28, GET_SL_LEVEL(23), 0);
    // Teddie uses Shu's message variables as he's only available at night
    if(timeOfDay != 5)
    {
        SET_MSG_VAR(28, GET_SL_LEVEL(24), 0);
    }

    if (GET_SL_LEVEL(16) > 0)
    {
        SET_MSG_VAR(29, GET_SL_LEVEL(16), 0);
    }
    else
    {
        SET_MSG_VAR(29, GET_SL_LEVEL(17), 0);
    }

    SET_MSG_VAR(30, GET_SL_LEVEL(7), 0);

    if (GET_SL_LEVEL(5) >= GET_SL_LEVEL(6))
    {
        SET_MSG_VAR(31, GET_SL_LEVEL(5), 0);
    }
    else
    {
        SET_MSG_VAR(31, GET_SL_LEVEL(6), 0);
    }

    if (GET_SL_LEVEL(25) > 0 || GET_SL_LEVEL(26) > 0 || (GET_SL_LEVEL(25) == 0 && GET_SL_LEVEL(26) == 0 && GET_SL_LEVEL(27) == 0 && GET_SL_LEVEL(28) == 0))
    {
        if (GET_SL_LEVEL(25) >= GET_SL_LEVEL(26))
        {
            SET_MSG_VAR(19, GET_SL_LEVEL(25), 0);
        }
        else
        {
            SET_MSG_VAR(19, GET_SL_LEVEL(26), 0);
        }
    }

    // Set B button to nobody
    SEL_CHK_PAD(14, 29);
    // Set bumpers to someone else if it's available
    if (pageTwoMask != 268435455)
    {
        SEL_CHK_PAD(10, 28);
        SEL_CHK_PAD(11, 28);
		SEL_CHK_PAD(5, 28);
        SEL_CHK_PAD(7, 28);
    }

    int localVariable56 = ADV_SEL(localVariable54, localVariable55, pageOneMask);

    // Field major and minor to make sure you can't tp to the current location
    int fieldMajor = GET_FIELD_MAJOR();
    int fieldMinor = GET_FIELD_MINOR();

_choiceLoop:
    // Cancel or see more wasn't chosen
    if (localVariable56 < 28)
    {
        // Checks whether the selection should be canceled (for when leaving home for the day)
        int cancelSel = 0;

        // Show confirmation for leaving home for the day if applicable
        if (timeOfDay != 5 && fieldMajor == 7 && (fieldMinor == 2 || fieldMinor == 3))
        {
            OPEN_MSG_WIN();
            MSG(EXIT_MYHOME_OK);
            SEL_CHK_PAD(14, 1);
            cancelSel = SEL(YESNO_SEL);
        }

        // Message that you should tell Dojima about your job if applicable
        if(localVariable56 != 6 && localVariable56 != 14 && ((BIT_CHK( 0 + 0x0400 + 671 ) == 1 && BIT_CHK( 0 + 0x0400 + 663 ) == 0 && (BIT_CHK( 0 + 0x0400 + 1056 ) == 1 || BIT_CHK( 0 + 0x0400 + 1638 ) == 1 || BIT_CHK( 0 + 0x0400 + 1640 ) == 1)) && timeOfDay == 5 && (BIT_CHK( 0 + 0x0400 + 455 ) || BIT_CHK( 0 + 0x0400 + 439 ))))
        {
            OPEN_MSG_WIN();
            MSG( STOP_OUTDOOR_DOUJIMA_2_1 );
            MSG( BAITO_ADMIT_2 );
            CLOSE_MSG_WIN();
            return;
        }

        if (cancelSel == 0)
        {
            // Some extra stuff is needed when leaving Okina so weather is preserved
            if (fieldMajor == 11)
            {
                BIT_OFF(0 + 0x0400 + 0x0800 + 172);
                BIT_OFF(0 + 0x0400 + 0x0800 + 171);
                if (GET_CNT(169) != 0)
                {

                    if (DATE_CHK(3, 20) == 1)
                    {
                        SET_CNT(169, 0);
                        FUNCTION_006B(-1);
                        FUNCTION_006B(1);
                    }
                    else
                    {
                        SET_CNT(169, 0);
                        FUNCTION_006B(-1);
                    }
                }
            }

            // Plays the sound effect if you are leaving home
            else if (fieldMajor == 7 && fieldMinor != 1 && localVariable56 != 6 && localVariable56 != 14 )
            {
                PLAY_SOUNDEFFECT( 7 );
            }

            // Teleport the player to the desired location depending on who they chose
            switch (localVariable56)
            {
            // Adachi
            case 0:
                // South Shopping District in the night
                if (timeOfDay == 5)
                {
                    if (fieldMajor == 8 && fieldMinor == 2)
                    {
                        OPEN_MSG_WIN();
                        MSG(ADACHI_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 6, 0);
                    }
                    // Junes in the day
                }
                else
                {
                    if (fieldMajor == 9 && fieldMinor == 4)
                    {
                        OPEN_MSG_WIN();
                        MSG(ADACHI_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(9, 4, 0, 0);
                    }
                }
                break;
            // Ai - Learning Building 1F
            case 1:
                if ((fieldMajor == 6 && fieldMinor == 1) || (fieldMajor == 8 && fieldMinor == 2 && timeOfDay == 5))
                {
                    OPEN_MSG_WIN();
                    MSG(AI_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else if(timeOfDay != 5)
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(6, 1, 5, 0);
                } else {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 3, 0);
                }
                break;
            // Ayane - Learning Building 2F
            case 2:
                if ((fieldMajor == 6 && fieldMinor == 2 && (GET_SL_LEVEL(27) > 0 || GET_SL_LEVEL(28) > 0)) || (fieldMajor == 8 && fieldMinor == 2 && timeOfDay == 5))
                {
                    OPEN_MSG_WIN();
                    MSG(AYANE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else if ((GET_SL_LEVEL(27) > 0 || GET_SL_LEVEL(28) > 0) && timeOfDay != 5)
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(6, 2, 0, 0);
                }
                else if(timeOfDay == 5)
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 0, 0);
                }
                else if (fieldMajor == 6 && fieldMinor == 4 && (GET_SL_LEVEL(27) == 0 && GET_SL_LEVEL(28) == 0))
                {
                    OPEN_MSG_WIN();
                    MSG(AYANE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(6, 4, 4, 0);
                }
                break;

            // Chie
            case 3:
                // South Shopping District on Sundays
                if (isHoliday == 1)
                {
                    if (fieldMajor == 8 && fieldMinor == 2)
                    {
                        OPEN_MSG_WIN();
                        MSG(CHIE_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 2, 0);
                    }
                    // Roof on Weekdays
                }
                else
                {
                    if ((fieldMajor == 6 && fieldMinor == 14) || (fieldMajor == 8 && fieldMinor == 1 && timeOfDay == 5))
                    {
                        OPEN_MSG_WIN();
                        MSG(CHIE_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else if(timeOfDay != 5)
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(6, 14, 1, 0);
                    } 
                    else 
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 1, 4, 0);
                    }
                }
                break;
            // Chie Scooter
            case 4:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(CHIE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 8, 0);
                }
                break;
            // Daisuke - Learning Building 2F
            case 5:
                if ((fieldMajor == 6 && fieldMinor == 2 && GET_SL_LEVEL(17) > 0) || (fieldMajor == 8 && fieldMinor == 1 && timeOfDay == 5))
                {
                    OPEN_MSG_WIN();
                    MSG(DAISUKE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else if (GET_SL_LEVEL(17) > 0 && timeOfDay != 5)
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(6, 2, 4, 0);
                }
                else if (fieldMajor == 6 && fieldMinor == 1 && GET_SL_LEVEL(17) == 0)
                {
                    OPEN_MSG_WIN();
                    MSG(DAISUKE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else if(timeOfDay != 5)
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(6, 1, 2, 0);
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 1, 8, 0);
                }
                
                break;
            // Dojima - Home
            case 6:
                if (fieldMajor == 7 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(DOJIMA_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    // Play the open door sound effect if coming down from your room
                    if(fieldMajor == 7 && fieldMinor == 3){
                        PLAY_SOUNDEFFECT( 702 );
                        //FLD_FUNCTION_0008( 10241, 1, 0, 0, 1 );
                        FADE( 1, 5 );
                        FADE_SYNC();
                        PLAY_SOUNDEFFECT( 173 );
                        //WAIT( 5 );
                        CALL_FIELD( 7, 2, 0, 0 );
                    }
                    // Play the sliding door sound effect if coming into the house
                    else
                    {
                        PLAY_SOUNDEFFECT( 7 );
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(7, 2, 0, 0);
                    }
                }
                break;
            // Eri - South Shopping District
            case 7:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(BUS_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 6, 0);
                }
                break;
            // Fox - Shrine
            case 8:
                if (fieldMajor == 8 && fieldMinor == 9)
                {
                    OPEN_MSG_WIN();
                    MSG(SHRINE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 9, 1, 0);
                }
                break;
            // Hisano - Samegawa Riverbank
            case 9:
                if (fieldMajor == 10 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(HISANO_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(10, 2, 0, 0);
                }
                break;
            // Kanji
            case 10:
                // North Shopping District on Sundays
                if (isHoliday == 1)
                {
                    if (fieldMajor == 8 && fieldMinor == 1)
                    {
                        OPEN_MSG_WIN();
                        MSG(KANJI_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 1, 5, 0);
                    }
                    // Practice Building 1F on Weekdays
                }
                else
                {
                    if ((fieldMajor == 6 && fieldMinor == 4) || (fieldMajor == 8 && fieldMinor == 1 && timeOfDay == 5))
                    {
                        OPEN_MSG_WIN();
                        MSG(KANJI_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else if(timeOfDay != 5)
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(6, 4, 5, 0);
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 1, 5, 0);
                    }
                    
                }
                break;
            // Kanji Scooter
            case 11:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(KANJI_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 8, 0);
                }
                break;
            // Kou - Learning Building 2F
            case 12:
                if ((fieldMajor == 6 && fieldMinor == 2 && GET_SL_LEVEL(16) > 0) || (fieldMajor == 8 && fieldMinor == 1 && timeOfDay == 5))
                {
                    OPEN_MSG_WIN();
                    MSG(KOU_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else if (GET_SL_LEVEL(16) > 0 && timeOfDay != 5)
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(6, 2, 4, 0);
                }
                else if (fieldMajor == 6 && fieldMinor == 1 && GET_SL_LEVEL(16) == 0)
                {
                    OPEN_MSG_WIN();
                    MSG(KOU_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else if (timeOfDay != 5)
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(6, 1, 2, 0);
                } 
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 1, 8, 0);
                }
                
                break;

            // Marie - South Shopping District
            case 13:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(MARIE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 4, 0);
                }
                break;
            // Nanako - Home
            case 14:
                if (fieldMajor == 7 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(NANAKO_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    // Play the open door sound effect if coming down from your room
                    if(fieldMajor == 7 && fieldMinor == 3){
                        PLAY_SOUNDEFFECT( 702 );
                        //FLD_FUNCTION_0008( 10241, 1, 0, 0, 1 );
                        FADE( 1, 5 );
                        FADE_SYNC();
                        PLAY_SOUNDEFFECT( 173 );
                        //WAIT( 5 );
                        CALL_FIELD( 7, 2, 0, 0 );
                    }
                    // Play the sliding door sound effect if coming into the house
                    else
                    {
                        PLAY_SOUNDEFFECT( 7 );
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(7, 2, 0, 0);
                    }
                }
                break;
            // Naoki
            case 15:
                // North Shopping District on Sundays and whenever the s link level is not 0
                if (isHoliday == 1 || GET_SL_LEVEL(18) > 0)
                {
                    if (fieldMajor == 8 && fieldMinor == 1)
                    {
                        OPEN_MSG_WIN();
                        MSG(NAOKI_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else if (timeOfDay != 5)
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 1, 5, 0);
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 1, 2, 0);
                    }
                    
                    // Learning Building 1F on Weekdays
                }
                else
                {
                    if (fieldMajor == 6 && fieldMinor == 1)
                    {
                        OPEN_MSG_WIN();
                        MSG(NAOKI_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(6, 1, 6, 0);
                    }
                }
                break;
            // Naoto
            case 16:
                if(BIT_CHK( 0 + 0x0400 + 629 ) == 1 && timeOfDay != 5)
                {
                    if (fieldMajor == 8 && fieldMinor == 2)
                    {
                        OPEN_MSG_WIN();
                        MSG(NAOTO_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 8, 0);
                    }
                }
                // Samegawa Flood Plain on Sundays
                else if (isHoliday == 1)
                {
                    if (fieldMajor == 10 && fieldMinor == 1)
                    {
                        OPEN_MSG_WIN();
                        MSG(NAOTO_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(10, 1, 2, 0);
                    }
                    // Learning Building 1F on Weekdays
                }
                else
                {
                    if ((fieldMajor == 6 && fieldMinor == 1) || (fieldMajor == 8 && fieldMinor == 2 && timeOfDay == 5))
                    {
                        OPEN_MSG_WIN();
                        MSG(NAOTO_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else if(timeOfDay != 5)
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(6, 1, 4, 0);
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 7, 0);
                    }
                    
                }
                break;
            // Naoto Scooter
            case 17:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(NAOTO_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 8, 0);
                }
                break;
            // Rise
            case 18:
                if(BIT_CHK( 0 + 0x0400 + 624 ) == 1 && timeOfDay != 5)
                {
                    if (fieldMajor == 8 && fieldMinor == 2)
                    {
                        OPEN_MSG_WIN();
                        MSG(RISE_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 8, 0);
                    }
                }
                // South Shopping District on Sundays
                else if (isHoliday == 1)
                {
                    if (fieldMajor == 8 && fieldMinor == 2)
                    {
                        OPEN_MSG_WIN();
                        MSG(RISE_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 2, 0);
                    }
                    // Learning Building 1F on Weekdays
                }
                else
                {
                    if ((fieldMajor == 6 && fieldMinor == 1) || (fieldMajor == 8 && fieldMinor == 2 && timeOfDay == 5))
                    {
                        OPEN_MSG_WIN();
                        MSG(RISE_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else if(timeOfDay != 5)
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(6, 1, 3, 0);
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 2, 0);
                    }
                    
                }
                break;
            // Rise Scooter
            case 19:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(RISE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 8, 0);
                }
                break;
            // Sayoko - South Shopping District
            case 20:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(BUS_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 6, 0);
                }
                break;
            // Shu - South Shopping District
            case 21:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(BUS_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 6, 0);
                }
                break;
            // Teddie - South Shopping District
            case 22:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(TEDDIE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 8, 0);
                }
                break;
            // Yoskue
            case 23:
                // Check if Yosuke's at his scooter
                if(BIT_CHK( 0 + 0x0400 + 626 ) == 1 && timeOfDay != 5) 
                {
                    if (fieldMajor == 8 && fieldMinor == 2)
                    {
                        OPEN_MSG_WIN();
                        MSG(YOSUKE_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 8, 0);
                    }
                } 
                // Junes on Sundays
                else if (isHoliday == 1)
                {
                    if (fieldMajor == 9 && fieldMinor == 4)
                    {
                        OPEN_MSG_WIN();
                        MSG(YOSUKE_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(9, 4, 0, 0);
                    }
                    // Learning Building 2F on Weekdays
                }
                else
                {
                    if ((fieldMajor == 6 && fieldMinor == 2) || (fieldMajor == 8 && fieldMinor == 1 && timeOfDay == 5))
                    {
                        OPEN_MSG_WIN();
                        MSG(YOSUKE_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else if(timeOfDay != 5)
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(6, 2, 0, 0);
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 1, 5, 0);
                    }
                    
                }
                break;
            // Yosuke Scooter
            case 24:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(YOSUKE_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 8, 0);
                }
                break;
            // Yukiko
            case 25:
                if(BIT_CHK( 0 + 0x0400 + 625 ) == 1 && timeOfDay != 5)
                {
                    if (fieldMajor == 8 && fieldMinor == 2)
                    {
                        OPEN_MSG_WIN();
                        MSG(YUKIKO_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 8, 0);
                    }
                }
                // South Shopping District on Sundays
                else if (isHoliday == 1)
                {
                    if (fieldMajor == 8 && fieldMinor == 2)
                    {
                        OPEN_MSG_WIN();
                        MSG(YUKIKO_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 7, 0);
                    }
                    // Learning Building 1F on Weekdays
                }
                else
                {
                    if ((fieldMajor == 6 && fieldMinor == 1) || (fieldMajor == 8 && fieldMinor == 2 && timeOfDay == 5))
                    {
                        OPEN_MSG_WIN();
                        MSG(YUKIKO_ALREADY_HERE);
                        CLOSE_MSG_WIN();
                    }
                    else if(timeOfDay != 5)
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(6, 1, 0, 0);
                    }
                    else
                    {
                        FADE(1, 5);
                        FADE_SYNC();
                        CALL_FIELD(8, 2, 2, 0);
                    }
                    
                }
                break;
            // Yukiko Scooter
            case 26:
                if (fieldMajor == 8 && fieldMinor == 2)
                {
                    OPEN_MSG_WIN();
                    MSG(YUKIKO_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 8, 0);
                }
                break;
            // Yumi - Learning Building 2F
            case 27:
                if ((fieldMajor == 6 && fieldMinor == 2 && (GET_SL_LEVEL(25) > 0 || GET_SL_LEVEL(26) > 0)) || (fieldMajor == 8 && fieldMinor == 2 && timeOfDay == 5))
                {
                    OPEN_MSG_WIN();
                    MSG(YUMI_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else if ((GET_SL_LEVEL(25) > 0 || GET_SL_LEVEL(26) > 0) && timeOfDay != 5)
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(6, 2, 0, 0);
                }
                else if (timeOfDay == 5)
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(8, 2, 0, 0);
                }
                
                else if (fieldMajor == 6 && fieldMinor == 4 && (GET_SL_LEVEL(25) == 0 && GET_SL_LEVEL(26) == 0))
                {
                    OPEN_MSG_WIN();
                    MSG(YUMI_ALREADY_HERE);
                    CLOSE_MSG_WIN();
                }
                else
                {
                    FADE(1, 5);
                    FADE_SYNC();
                    CALL_FIELD(6, 4, 1, 0);
                }
                break;
            }
        }
    }
    // See more was chosen
    else if (localVariable56 == 28)
    {
        // Generate another menu
        SEL_CHK_PAD(14, 29);
        // Set bumpers to someone else
        SEL_CHK_PAD(10, 28);
        SEL_CHK_PAD(11, 28);
		SEL_CHK_PAD(5, 28);
        SEL_CHK_PAD(7, 28);
        // If you're on page one go to two and vice versa
        if (localVariable120 == 0)
        {
            localVariable120 = 1;
            localVariable56 = ADV_SEL(localVariable54, localVariable55, pageTwoMask);
        }
        else
        {
            localVariable120 = 0;
            localVariable56 = ADV_SEL(localVariable54, localVariable55, pageOneMask);
        }
        // Go back to the choices for round rwo (or more)
        goto _choiceLoop;
    }
}

void check_if_fox_ready()
{
    foxReady = ((BIT_CHK(0 + 325) == 1 && BIT_CHK(0 + 0x0400 + 1696) == 0) || (BIT_CHK(0 + 332) == 1 && BIT_CHK(0 + 0x0400 + 1697) == 0) 
    || (BIT_CHK(0 + 339) == 1 && BIT_CHK(0 + 0x0400 + 1698) == 0) || (BIT_CHK(0 + 345) == 1 && BIT_CHK(0 + 0x0400 + 1699) == 0) 
    || (BIT_CHK(0 + 349) == 1 && BIT_CHK(0 + 0x0400 + 1700) == 0) || (BIT_CHK(0 + 355) == 1 && BIT_CHK(0 + 0x0400 + 1701) == 0) 
    || (BIT_CHK(0 + 360) == 1 && BIT_CHK(0 + 0x0400 + 1702) == 0) || (BIT_CHK(0 + 361) == 1 && BIT_CHK(0 + 0x0400 + 1703) == 0) 
    || (BIT_CHK(0 + 367) == 1 && BIT_CHK(0 + 0x0400 + 1704) == 0));
}

void generate_selection_mask()
{
    pageOneMask = 0; // First list
    // All characters removed (subtracting from this adds them back to the second list)
    pageTwoMask = 268435455; // Second list

    // Count how many people were removed from the list so I can decide whether to make a second page
    numSelectionsRemoved = 0;

    // A local variable for each slink to track whether they've been removed or not (I'm sure this could be done better but idk how)
    // 1 means available (not removed) 0 means not available (removed)
    int adachiState = 1;
    int aiState = 1;
    int chieState = 1;
    int chieScooterState = 1;
    int ayaneState = 1;
    int daisukeState = 1;
    int dojimaState = 1;
    int eriState = 1;
    int foxState = 1;
    int hisanoState = 1;
    int kanjiState = 1;
    int kanjiScooterState = 1;
    int marieState = 1;
    int nanakoState = 1;
    int naokiState = 1;
    int naotoState = 1;
    int naotoScooterState = 1;
    int riseState = 1;
    int riseScooterState = 1;
    int sayokoState = 1;
    int shuState = 1;
    int teddieState = 1;
    int kouState = 1;
    int yosukeState = 1;
    int yosukeScooterState = 1;
    int yukikoState = 1;
    int yukikoScooterState = 1;
    int yumiState = 1;
    int localVariable116 = 1;

    //Check if it is a holiday
    check_if_holiday();

    int timeOfDay;
    timeOfDay = GET_TIME_OF_DAY();

    // 1 is spoiler free, 0 is spoiler mode
    int spoilerFree = BIT_CHK(5678);

    // Choose which people to exclude based on the day
    // Check Adachi
    if (BIT_CHK(0 + 0x0400 + 692) == 0 || BIT_CHK(0 + 0x0400 + 702) == 1 || BIT_CHK(0 + 0x0400 + 1569) == 1 || GET_SL_LEVEL(31) >= 6 || (CHECK_IF_SL_LVLUP(31) == 0 && timeOfDay == 5) || (CHECK_IF_SL_LVLUP(31) == 1 && ((timeOfDay == 5 && (GET_SL_LEVEL(31) == 1 || GET_SL_LEVEL(31) == 5)) || (timeOfDay != 5 && GET_SL_LEVEL(31) >= 2 && GET_SL_LEVEL(31) <= 4))) || (GET_SL_LEVEL(31) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 1;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        adachiState = 0;
    }

    // Ai isn't available Monday, Tuesday, Saturday, Sunday and Holidays
    if ((BIT_CHK(0 + 0x0400 + 468) == 0 && timeOfDay != 5) || GET_SL_LEVEL(21) >= 10 || GET_SL_LEVEL(22) >= 10 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1163) == 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 894) || (GET_SL_LEVEL(21) <= 0 && GET_SL_LEVEL(22) <= 0))) || (GET_SL_LEVEL(22) <= 0 && GET_SL_LEVEL(21) <= 0 && spoilerFree) || (GET_SL_LEVEL(22) <= 0 && GET_SL_LEVEL(21) <= 0 && GET_SL_LEVEL(16) < 4 && GET_SL_LEVEL(17) < 4) || BIT_CHK(2512))
    {
        pageOneMask = pageOneMask + 2;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        aiState = 0;
    }
    // Ayane isn't available Wednesday, Friday, Saturday, Sunday and Holiday
    if ((BIT_CHK(0 + 0x0400 + 475) == 0 && timeOfDay != 5) || GET_SL_LEVEL(27) >= 10 || GET_SL_LEVEL(28) >= 10 || GET_SL_LEVEL(25) > 0 || GET_SL_LEVEL(26) > 0 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1161) == 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 896) || (GET_SL_LEVEL(27) <= 0 && GET_SL_LEVEL(28) <= 0))) || (GET_SL_LEVEL(27) <= 0 && GET_SL_LEVEL(28) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 4;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        ayaneState = 0;
    }
    // Chie isn't available Friday and Sunday
    if ((((!BIT_CHK(0 + 0x0400 + 434) && BIT_CHK(0 + 0x0400 + 1569)) || (!BIT_CHK(0 + 0x0400 + 1569) && !BIT_CHK(0 + 0x0400 + 458))) && !isHoliday && timeOfDay != 5) || (isHoliday && timeOfDay != 5 && !BIT_CHK(0 + 0x0400 + 434) && !BIT_CHK(0 + 0x0400 + 458)) || GET_SL_LEVEL(11) >= 10 || GET_SL_LEVEL(12) >= 10 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1153) == 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 884) || (GET_SL_LEVEL(11) <= 0 && GET_SL_LEVEL(12) <= 0))) || (GET_SL_LEVEL(11) <= 0 && GET_SL_LEVEL(12) <= 0 && spoilerFree) || BIT_CHK(0 + 87) || BIT_CHK(0 + 0x0400 + 1217))
    {
        pageOneMask = pageOneMask + 8;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        chieState = 0;
    }
    // Chie scooter
    if(!(BIT_CHK( 0 + 0x0400 + 628 ) == 1 && timeOfDay != 5) || BIT_CHK( 0 + 87 ) || BIT_CHK( 0 + 0x0400 + 1569 )) 
    {
        pageOneMask = pageOneMask + 16;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        chieScooterState = 0;
    }
    // Daisuke isn't available Monday, Wednesday, Friday, Sunday and Holidays
    if ((BIT_CHK(0 + 0x0400 + 463) == 0 && timeOfDay != 5) || GET_SL_LEVEL(17) >= 10 || GET_SL_LEVEL(16) > 0 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1159) == 0 || GET_SL_LEVEL(17) <= 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 895))) || (GET_SL_LEVEL(17) <= 0 && spoilerFree) || (timeOfDay == 5 && (DATE_CHK(10, 3) && !BIT_CHK(0 + 0x0400 + 1569)) || (CHECK_TIME_SPAN(10, 5, 1, 1) && timeOfDay == 5)))
    {
        pageOneMask = pageOneMask + 32;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        daisukeState = 0;
    }
    // Dojima
    if (BIT_CHK(0 + 0x0400 + 455) == 0 || BIT_CHK( 0 + 0x0400 + 1569 ) || GET_SL_LEVEL(8) >= 10 || timeOfDay != 5 || (GET_SL_LEVEL(8) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 64;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        dojimaState = 0;
    }
    // Eri isn't available Tuesday, Wednesday, Thursday, Sunday and Holidays
    if (BIT_CHK(0 + 0x0400 + 1641) == 0 || BIT_CHK(0 + 0x0400 + 476) == 0 || GET_SL_LEVEL(29) >= 10 || timeOfDay == 5 || (GET_SL_LEVEL(29) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 128;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        eriState = 0;
    }
    // Fox
    check_if_fox_ready();
    if (!(foxReady || (BIT_CHK( 0 + 261 ) == 0 && GET_SL_LEVEL( 13 ) == 1) || (BIT_CHK( 0 + 268 ) == 0 && GET_SL_LEVEL( 13 ) == 2 ) 
    || (BIT_CHK( 0 + 275 ) == 0 && GET_SL_LEVEL( 13 ) == 3) || (BIT_CHK( 0 + 281 ) == 0 && GET_SL_LEVEL( 13 ) == 4) 
    || (BIT_CHK( 0 + 285 ) == 0 && GET_SL_LEVEL( 13 ) == 5) || (BIT_CHK( 0 + 291 ) == 0 && GET_SL_LEVEL( 13 ) == 6)
    || (BIT_CHK( 0 + 296 ) == 0 && GET_SL_LEVEL( 13 ) == 7) || (BIT_CHK( 0 + 297 ) == 0 && GET_SL_LEVEL( 13 ) == 8)
    || (BIT_CHK( 0 + 303 ) == 0 && GET_SL_LEVEL( 13 ) == 9))
    || GET_SL_LEVEL(13) >= 10 || timeOfDay == 5 || (GET_SL_LEVEL(13) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 256;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        foxState = 0;
    }
    // Hisano is only available on Sundays and Holidays
    if (BIT_CHK(0 + 0x0400 + 466) == 0 || GET_SL_LEVEL(19) >= 10 || timeOfDay == 5 || (GET_SL_LEVEL(19) <= 0 && spoilerFree) || (GET_SL_LEVEL(19) <= 0 && GET_SL_LEVEL(9) < 4))
    {
        pageOneMask = pageOneMask + 512;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        hisanoState = 0;
    }
    // Kanji isn't available Monday, Tuesday and Friday
    if ((((!BIT_CHK(0 + 0x0400 + 433) && BIT_CHK(0 + 0x0400 + 1569)) || (!BIT_CHK(0 + 0x0400 + 1569) && !BIT_CHK(0 + 0x0400 + 457))) && !isHoliday && timeOfDay != 5) || (isHoliday && timeOfDay != 5 && !BIT_CHK(0 + 0x0400 + 433) && !BIT_CHK(0 + 0x0400 + 457)) || GET_SL_LEVEL(10) >= 10 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1155) == 0 || GET_SL_LEVEL(10) <= 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 886))) || (GET_SL_LEVEL(10) <= 0 && spoilerFree) || BIT_CHK(0 + 87) || BIT_CHK(0 + 0x0400 + 1219))
    {
        pageOneMask = pageOneMask + 1024;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        kanjiState = 0;
    }
    // Kanji Scooter
    if(!(BIT_CHK( 0 + 0x0400 + 627 ) == 1 && timeOfDay != 5) || BIT_CHK( 0 + 87 ) || BIT_CHK( 0 + 0x0400 + 1569 )) 
    {
        pageOneMask = pageOneMask + 2048;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        kanjiScooterState = 0;
    }
    // Kou isn't available Monday, Wednesday, Friday, Sunday and Holidays
    if ((BIT_CHK(0 + 0x0400 + 463) == 0 && timeOfDay != 5) || GET_SL_LEVEL(0x10) >= 10 || GET_SL_LEVEL(17) > 0 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1158) == 0 || GET_SL_LEVEL(16) <= 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 895))) || (GET_SL_LEVEL(16) <= 0 && spoilerFree) || (timeOfDay == 5 && (DATE_CHK(10, 3) && !BIT_CHK(0 + 0x0400 + 1569)) || (CHECK_TIME_SPAN(10, 5, 1, 1) && timeOfDay == 5)))
    {
        pageOneMask = pageOneMask + 4096;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        kouState = 0;
    }
    // Marie isn't available Monday, Tuesday, Thursday and Friday
    if (BIT_CHK(0 + 0x0400 + 712) == 0 || GET_SL_LEVEL(33) >= 10 || GET_SL_LEVEL(34) >= 10 || timeOfDay == 5 || (GET_SL_LEVEL(33) <= 0 && GET_SL_LEVEL(34) <= 0 && spoilerFree) || BIT_CHK( 0 + 87 ) == 1 || (EVT_FUNCTION_0002( 33 ) == 0 && EVT_FUNCTION_0002( 34 ) == 0 && BIT_CHK( 0 + 0x0400 + 527 ) == 1) || (CHECK_TIME_SPAN(4, 11, 7, 23) && (CHECK_IF_SL_LVLUP(33) || CHECK_IF_SL_LVLUP(34)) && (GET_SL_LEVEL(33) == 4 || GET_SL_LEVEL(34) == 4)))
    {
        pageOneMask = pageOneMask + 8192;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        marieState = 0;
    }
    // Nanako
    if (BIT_CHK(0 + 0x0400 + 449) == 0 || GET_SL_LEVEL(2) >= 10 || timeOfDay != 5 || (GET_SL_LEVEL(2) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 16384;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        nanakoState = 0;
    }
    // Naoki isn't available Friday, Saturday and Sunday
    if ((BIT_CHK(0 + 0x0400 + 465) == 0 && timeOfDay != 5) || GET_SL_LEVEL(18) >= 10 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1162) == 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 891) || GET_SL_LEVEL(18) <= 0)) || (GET_SL_LEVEL(18) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 32768;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        naokiState = 0;
    }
    // Naoto isn't available Thursday and Friday
    if ((((!BIT_CHK(0 + 0x0400 + 461) && BIT_CHK(0 + 0x0400 + 1569)) || (!BIT_CHK(0 + 0x0400 + 1569) && !BIT_CHK(0 + 0x0400 + 462))) && !isHoliday && timeOfDay != 5) || (isHoliday && timeOfDay != 5 && !BIT_CHK(0 + 0x0400 + 462) && !BIT_CHK(0 + 0x0400 + 461)) || (BIT_CHK(0 + 0x0400 + 1569) && CHECK_TIME_SPAN(11, 6, 11, 20)) || GET_SL_LEVEL(14) >= 10 || GET_SL_LEVEL(15) >= 10 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1157) == 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 889) || (GET_SL_LEVEL(14) <= 0 && GET_SL_LEVEL(15) <= 0))) || (GET_SL_LEVEL(14) <= 0 && GET_SL_LEVEL(15) <= 0 && spoilerFree) || BIT_CHK(0 + 87) || BIT_CHK(0 + 0x0400 + 1221))
    {
        pageOneMask = pageOneMask + 65536;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        naotoState = 0;
    }
    // Naoto Scooter
    if(!(BIT_CHK( 0 + 0x0400 + 629 ) == 1 && timeOfDay != 5) || BIT_CHK( 0 + 87 ) || BIT_CHK( 0 + 0x0400 + 1569 )) 
    {
        pageOneMask = pageOneMask + 131072;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        naotoScooterState = 0;
    }  
    // Rise isn't available Monday, Tuesday, Wednesday and Thursday
    if ((((!BIT_CHK(0 + 0x0400 + 436) && BIT_CHK(0 + 0x0400 + 1569)) || (!BIT_CHK(0 + 0x0400 + 1569) && !BIT_CHK(0 + 0x0400 + 451))) && !isHoliday && timeOfDay != 5) || (isHoliday && timeOfDay != 5 && !BIT_CHK(0 + 0x0400 + 436) && !BIT_CHK(0 + 0x0400 + 451)) || GET_SL_LEVEL(3) >= 10 || GET_SL_LEVEL(4) >= 10 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1156) == 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 887) || (GET_SL_LEVEL(3) <= 0 && GET_SL_LEVEL(4) <= 0))) || (GET_SL_LEVEL(3) <= 0 && GET_SL_LEVEL(4) <= 0 && spoilerFree) || BIT_CHK(0 + 87) || BIT_CHK(0 + 0x0400 + 1220))
    {
        pageOneMask = pageOneMask + 262144;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        riseState = 0;
    }
    // Rise Scooter
    if(!(BIT_CHK( 0 + 0x0400 + 624 ) == 1 && timeOfDay != 5) || BIT_CHK( 0 + 87 ) || BIT_CHK( 0 + 0x0400 + 1569 )) 
    {
        pageOneMask = pageOneMask + 524288;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        riseScooterState = 0;
    }   
    // Sayoko isn't available Monday, Tuesday, Saturday, Sunday, Holidays, and in the day
    if (BIT_CHK(0 + 0x0400 + 456) == 0 || BIT_CHK(0 + 0x0400 + 1640) == 0 || timeOfDay != 5 || GET_SL_LEVEL(9) >= 10 || (GET_SL_LEVEL(9) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 1048576;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        sayokoState = 0;
    }
    // Shu isn't available Monday, Wednesday, Friday, Sunday, Holidays and in the day
    if (BIT_CHK(0 + 0x0400 + 470) == 0 || BIT_CHK(0 + 0x0400 + 1638) == 0 || GET_SL_LEVEL(23) >= 10 || timeOfDay != 5 || (GET_SL_LEVEL(23) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 2097152;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        shuState = 0;
    }
    // Teddie is only available at his scooter (he doesn't actually have a scooter but you know what I mean)
    if (!(BIT_CHK( 0 + 0x0400 + 630 ) == 1 && timeOfDay != 5 && BIT_CHK( 0 + 0x0400 + 1569 ) == 0) || BIT_CHK( 0 + 87 ))
    {
        pageOneMask = pageOneMask + 4194304;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        teddieState = 0;
    }
    // Yosuke isn't available Tuesday and Wednesday
    if ((((!BIT_CHK(0 + 0x0400 + 432) && BIT_CHK(0 + 0x0400 + 1569)) || (!BIT_CHK(0 + 0x0400 + 1569) && !BIT_CHK(0 + 0x0400 + 454))) && !isHoliday && timeOfDay != 5) || (isHoliday && timeOfDay != 5 && !BIT_CHK(0 + 0x0400 + 432) && !BIT_CHK(0 + 0x0400 + 454)) || GET_SL_LEVEL(7) >= 10 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1152) == 0 || GET_SL_LEVEL(7) <= 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 883))) || (GET_SL_LEVEL(7) <= 0 && spoilerFree) || BIT_CHK(0 + 87) || BIT_CHK(0 + 0x0400 + 1216))
    {
        pageOneMask = pageOneMask + 8388608;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        yosukeState = 0;
    }
    // Yosuke Scooter
    if(!(BIT_CHK( 0 + 0x0400 + 626 ) == 1 && timeOfDay != 5) || BIT_CHK( 0 + 87 ) || BIT_CHK( 0 + 0x0400 + 1569 )) 
    {
        pageOneMask = pageOneMask + 16777216;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        yosukeScooterState = 0;
    }
    // Yukiko isn't available Friday, Saturday and Sunday
    if ((((!BIT_CHK(0 + 0x0400 + 435) && BIT_CHK(0 + 0x0400 + 1569)) || (!BIT_CHK(0 + 0x0400 + 1569) && !BIT_CHK(0 + 0x0400 + 452))) && !isHoliday && timeOfDay != 5) || (isHoliday && timeOfDay != 5 && !BIT_CHK(0 + 0x0400 + 435) && !BIT_CHK(0 + 0x0400 + 452)) || GET_SL_LEVEL(5) >= 10 || GET_SL_LEVEL(6) >= 10 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1154) == 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 885) || (GET_SL_LEVEL(5) <= 0 && GET_SL_LEVEL(6) <= 0))) || (GET_SL_LEVEL(5) <= 0 && GET_SL_LEVEL(6) <= 0 && spoilerFree) || BIT_CHK(0 + 87) || BIT_CHK(0 + 0x0400 + 1218))
    {
        pageOneMask = pageOneMask + 33554432;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        yukikoState = 0;
    }
    // Yukiko Scooter
    if(!(BIT_CHK( 0 + 0x0400 + 625 ) == 1 && timeOfDay != 5) || BIT_CHK( 0 + 87 ) || BIT_CHK( 0 + 0x0400 + 1569 )) 
    {
        pageOneMask = pageOneMask + 67108864;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        yukikoScooterState = 0;
    }
    // Yumi isn't available Wednesday, Friday, Saturday, Sunday and Holiday
    if ((BIT_CHK(0 + 0x0400 + 475) == 0 && timeOfDay != 5) || GET_SL_LEVEL(25) >= 10 || GET_SL_LEVEL(26) >= 10 || GET_SL_LEVEL(28) > 0 || GET_SL_LEVEL(27) > 0 || (timeOfDay == 5 && (BIT_CHK(0 + 0x0400 + 1160) == 0 || BIT_CHK(0 + 0x0400 + 0x0800 + 896) || (GET_SL_LEVEL(25) <= 0 && GET_SL_LEVEL(26) <= 0))) || (GET_SL_LEVEL(25) <= 0 && GET_SL_LEVEL(26) <= 0 && spoilerFree))
    {
        pageOneMask = pageOneMask + 134217728;
        numSelectionsRemoved = numSelectionsRemoved + 1;
        yumiState = 0;
    }

    // Decide whether a second page is needed
    if (numSelectionsRemoved <= 21)
    {
        // pageTwoMask is all characters removed (subtracting from this adds them back to the second list)
        // Yumi
        if (yumiState == 1)
        {
            // Remove from list 1
            pageOneMask = pageOneMask + 134217728;
            // Add to list 2
            pageTwoMask = pageTwoMask - 134217728;
            // Increment the count
            numSelectionsRemoved = numSelectionsRemoved + 1;
        }
        // Yukiko Scooter
        if (numSelectionsRemoved <= 22)
        {
            if (yukikoScooterState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 67108864;
                // Add to list 2
                pageTwoMask = pageTwoMask - 67108864;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Yukiko
        if (numSelectionsRemoved <= 22)
        {
            if (yukikoState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 33554432;
                // Add to list 2
                pageTwoMask = pageTwoMask - 33554432;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Yosuke Scooter
        if (numSelectionsRemoved <= 22)
        {
            if (yosukeScooterState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 16777216;
                // Add to list 2
                pageTwoMask = pageTwoMask - 16777216;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Yosuke
        if (numSelectionsRemoved <= 22)
        {
            if (yosukeState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 8388608;
                // Add to list 2
                pageTwoMask = pageTwoMask - 8388608;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Teddie
        if (numSelectionsRemoved <= 22)
        {
            if (teddieState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 4194304;
                // Add to list 2
                pageTwoMask = pageTwoMask - 4194304;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Shu
        if (numSelectionsRemoved <= 22)
        {
            if (shuState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 2097152;
                // Add to list 2
                pageTwoMask = pageTwoMask - 2097152;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Sayoko
        if (numSelectionsRemoved <= 22)
        {
            if (sayokoState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 1048576;
                // Add to list 2
                pageTwoMask = pageTwoMask - 1048576;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Rise Scooter
        if (numSelectionsRemoved <= 22)
        {
            if (riseScooterState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 524288;
                // Add to list 2
                pageTwoMask = pageTwoMask - 524288;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Rise
        if (numSelectionsRemoved <= 22)
        {
            if (riseState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 262144;
                // Add to list 2
                pageTwoMask = pageTwoMask - 262144;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Naoto Scooter
        if (numSelectionsRemoved <= 22)
        {
            if (naotoScooterState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 131072;
                // Add to list 2
                pageTwoMask = pageTwoMask - 131072;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Naoto
        if (numSelectionsRemoved <= 22)
        {
            if (naotoState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 65536;
                // Add to list 2
                pageTwoMask = pageTwoMask - 65536;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Naoki
        if (numSelectionsRemoved <= 22)
        {
            if (naokiState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 32768;
                // Add to list 2
                pageTwoMask = pageTwoMask - 32768;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Nanako
        if (numSelectionsRemoved <= 22)
        {
            if (nanakoState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 16384;
                // Add to list 2
                pageTwoMask = pageTwoMask - 16384;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Marie
        if (numSelectionsRemoved <= 22)
        {
            if (marieState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 8192;
                // Add to list 2
                pageTwoMask = pageTwoMask - 8192;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Kou
        if (numSelectionsRemoved <= 22)
        {
            if (kouState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 4096;
                // Add to list 2
                pageTwoMask = pageTwoMask - 4096;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Kanji
        if (numSelectionsRemoved <= 22)
        {
            if (kanjiScooterState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 2048;
                // Add to list 2
                pageTwoMask = pageTwoMask - 2048;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Kanji
        if (numSelectionsRemoved <= 22)
        {
            if (kanjiState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 1024;
                // Add to list 2
                pageTwoMask = pageTwoMask - 1024;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Hisano
        if (numSelectionsRemoved <= 22)
        {
            if (hisanoState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 512;
                // Add to list 2
                pageTwoMask = pageTwoMask - 512;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Fox
        if (numSelectionsRemoved <= 22)
        {
            if (foxState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 256;
                // Add to list 2
                pageTwoMask = pageTwoMask - 256;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Eri
        if (numSelectionsRemoved <= 22)
        {
            if (eriState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 128;
                // Add to list 2
                pageTwoMask = pageTwoMask - 128;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Dojima
        if (numSelectionsRemoved <= 22)
        {
            if (dojimaState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 64;
                // Add to list 2
                pageTwoMask = pageTwoMask - 64;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Daisuke
        if (numSelectionsRemoved <= 22)
        {
            if (daisukeState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 32;
                // Add to list 2
                pageTwoMask = pageTwoMask - 32;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // Chie Scooter
        if (numSelectionsRemoved <= 22)
        {
            if (chieScooterState == 1)
            {
                // Remove from list 1
                pageOneMask = pageOneMask + 16;
                // Add to list 2
                pageTwoMask = pageTwoMask - 16;
                // Increment the count
                numSelectionsRemoved = numSelectionsRemoved + 1;
            }
        }
        // We don't need the see more option
    }
    else
    {
        pageOneMask = pageOneMask + 268435456;
    }
}


void check_if_holiday()
{
    // This is the logic lmap uses so it should be right
    if (DATE_CHK(4, 12) == 1 || GET_TIME_OF_DAY() == 3)
    {
        isHoliday = 1;
    }
    else
    {
        isHoliday = 0;
    }
}
